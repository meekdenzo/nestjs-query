"use strict";(self.webpackChunknestjs_query=self.webpackChunknestjs_query||[]).push([[6089],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>c});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=d(t),m=r,c=p["".concat(s,".").concat(m)]||p[m]||g[m]||o;return t?a.createElement(c,l(l({ref:n},u),{},{components:t})):a.createElement(c,l({ref:n},u))}));function c(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[p]="string"==typeof e?e:r,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5162:(e,n,t)=>{t.d(n,{Z:()=>l});var a=t(7294),r=t(4334);const o={tabItem:"tabItem_Ymn6"};function l(e){var n=e.children,t=e.hidden,l=e.className;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,l),hidden:t},n)}},4866:(e,n,t)=>{t.d(n,{Z:()=>v});var a=t(7462),r=t(7294),o=t(4334),l=t(2466),i=t(6550),s=t(1980),d=t(7392),u=t(12);function p(e){return function(e){var n,t;return null!=(n=null==(t=r.Children.map(e,(function(e){if(!e||(0,r.isValidElement)(e)&&(n=e.props)&&"object"==typeof n&&"value"in n)return e;var n;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}(e).map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}}))}function g(e){var n=e.values,t=e.children;return(0,r.useMemo)((function(){var e=null!=n?n:p(t);return function(e){var n=(0,d.l)(e,(function(e,n){return e.value===n.value}));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function m(e){var n=e.value;return e.tabValues.some((function(e){return e.value===n}))}function c(e){var n=e.queryString,t=void 0!==n&&n,a=e.groupId,o=(0,i.k6)(),l=function(e){var n=e.queryString,t=void 0!==n&&n,a=e.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:t,groupId:a});return[(0,s._X)(l),(0,r.useCallback)((function(e){if(l){var n=new URLSearchParams(o.location.search);n.set(l,e),o.replace(Object.assign({},o.location,{search:n.toString()}))}}),[l,o])]}function b(e){var n,t,a,o,l=e.defaultValue,i=e.queryString,s=void 0!==i&&i,d=e.groupId,p=g(e),b=(0,r.useState)((function(){return function(e){var n,t=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var r=null!=(n=a.find((function(e){return e.default})))?n:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:l,tabValues:p})})),T=b[0],y=b[1],k=c({queryString:s,groupId:d}),f=k[0],h=k[1],v=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:d}.groupId),t=(0,u.Nk)(n),a=t[0],o=t[1],[a,(0,r.useCallback)((function(e){n&&o.set(e)}),[n,o])]),I=v[0],N=v[1],A=function(){var e=null!=f?f:I;return m({value:e,tabValues:p})?e:null}();return(0,r.useLayoutEffect)((function(){A&&y(A)}),[A]),{selectedValue:T,selectValue:(0,r.useCallback)((function(e){if(!m({value:e,tabValues:p}))throw new Error("Can't select invalid tab value="+e);y(e),h(e),N(e)}),[h,N,p]),tabValues:p}}var T=t(2389);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){var n=e.className,t=e.block,i=e.selectedValue,s=e.selectValue,d=e.tabValues,u=[],p=(0,l.o5)().blockElementScrollPositionUntilNextRender,g=function(e){var n=e.currentTarget,t=u.indexOf(n),a=d[t].value;a!==i&&(p(n),s(a))},m=function(e){var n,t=null;switch(e.key){case"Enter":g(e);break;case"ArrowRight":var a,r=u.indexOf(e.currentTarget)+1;t=null!=(a=u[r])?a:u[0];break;case"ArrowLeft":var o,l=u.indexOf(e.currentTarget)-1;t=null!=(o=u[l])?o:u[u.length-1]}null==(n=t)||n.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n)},d.map((function(e){var n=e.value,t=e.label,l=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,key:n,ref:function(e){return u.push(e)},onKeyDown:m,onClick:g},l,{className:(0,o.Z)("tabs__item",y.tabItem,null==l?void 0:l.className,{"tabs__item--active":i===n})}),null!=t?t:n)})))}function f(e){var n=e.lazy,t=e.children,a=e.selectedValue,o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){var l=o.find((function(e){return e.props.value===a}));return l?(0,r.cloneElement)(l,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})})))}function h(e){var n=b(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",y.tabList)},r.createElement(k,(0,a.Z)({},e,n)),r.createElement(f,(0,a.Z)({},e,n)))}function v(e){var n=(0,T.Z)();return r.createElement(h,(0,a.Z)({key:String(n)},e))}},1042:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>g,contentTitle:()=>u,default:()=>T,frontMatter:()=>d,metadata:()=>p,toc:()=>m});var a=t(7462),r=t(3366),o=(t(7294),t(3905)),l=t(4866),i=t(5162),s=["components"],d={title:"Aggregations"},u=void 0,p={unversionedId:"graphql/aggregations",id:"graphql/aggregations",title:"Aggregations",description:"When aggregations are enabled nestjs-query will expose a new query that enables using the following common aggregations count, avg, sum, min, and max.",source:"@site/docs/graphql/aggregations.mdx",sourceDirName:"graphql",slug:"/graphql/aggregations",permalink:"/nestjs-query/docs/graphql/aggregations",draft:!1,editUrl:"https://github.com/tripss/nestjs-query/edit/master/documentation/docs/graphql/aggregations.mdx",tags:[],version:"current",frontMatter:{title:"Aggregations"},sidebar:"docs",previous:{title:"Authorization",permalink:"/nestjs-query/docs/graphql/authorization"},next:{title:"Subscriptions",permalink:"/nestjs-query/docs/graphql/subscriptions"}},g={},m=[{value:"Enabling Aggregate Queries",id:"enabling-aggregate-queries",level:3},{value:"Examples",id:"examples",level:2},{value:"Basic",id:"basic",level:3},{value:"With GroupBy",id:"with-groupby",level:3},{value:"With Filter",id:"with-filter",level:3},{value:"Aggregating Relations",id:"aggregating-relations",level:2},{value:"Examples",id:"examples-1",level:2},{value:"Basic",id:"basic-1",level:3},{value:"With GroupBy",id:"with-groupby-1",level:3},{value:"With Filter",id:"with-filter-1",level:3},{value:"Advanced",id:"advanced",level:2},{value:"Enabling Aggregates Only For Root",id:"enabling-aggregates-only-for-root",level:3},{value:"Disable Aggregate for Single Relation",id:"disable-aggregate-for-single-relation",level:3},{value:"Group aggregate on DAY/WEEK/MONTH",id:"group-aggregate-on-dayweekmonth",level:3}],c={toc:m},b="wrapper";function T(e){var n=e.components,t=(0,r.Z)(e,s);return(0,o.kt)(b,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"When aggregations are enabled ",(0,o.kt)("inlineCode",{parentName:"p"},"nestjs-query")," will expose a new query that enables using the following common aggregations ",(0,o.kt)("inlineCode",{parentName:"p"},"count"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"avg"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"sum"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"min"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"max"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Only fields decorated with ",(0,o.kt)("inlineCode",{parentName:"p"},"@FilterableField")," will be exposed in aggregate queries.")),(0,o.kt)("p",null,"All examples will be based on the following ",(0,o.kt)("inlineCode",{parentName:"p"},"TodoItem")," DTO. All fields except ",(0,o.kt)("inlineCode",{parentName:"p"},"age"),", because it is not decorated with\n",(0,o.kt)("inlineCode",{parentName:"p"},"@FilterableField")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"@IDField"),", will be exposed in aggregate queries."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item/dto/todo-item.dto.ts"',title:'"todo-item/dto/todo-item.dto.ts"'},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n\n  @Field()\n  age!: number;\n\n  @FilterableField()\n  priority!: number;\n}\n\n")),(0,o.kt)("h3",{id:"enabling-aggregate-queries"},"Enabling Aggregate Queries"),(0,o.kt)("p",null,"To enable aggregate queries you can set the ",(0,o.kt)("inlineCode",{parentName:"p"},"enableAggregate")," option in your resolver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item/todo-item.module.ts" {19}',title:'"todo-item/todo-item.module.ts"',"{19}":!0},"import { NestjsQueryGraphQLModule } from '@ptc-org/nestjs-query-graphql';\nimport { NestjsQueryTypeOrmModule } from '@ptc-org/nestjs-query-typeorm';\nimport { Module } from '@nestjs/common';\nimport { TodoItemInputDTO } from './dto/todo-item-input.dto';\nimport { TodoItemUpdateDTO } from './dto/todo-item-update.dto';\nimport { TodoItemDTO } from './dto/todo-item.dto';\nimport { TodoItemEntity } from './todo-item.entity';\n\n@Module({\n  imports: [\n    NestjsQueryGraphQLModule.forFeature({\n      imports: [NestjsQueryTypeOrmModule.forFeature([TodoItemEntity])],\n      resolvers: [\n        {\n          DTOClass: TodoItemDTO,\n          EntityClass: TodoItemEntity,\n          CreateDTOClass: TodoItemInputDTO,\n          UpdateDTOClass: TodoItemUpdateDTO,\n          enableAggregate: true\n        },\n      ],\n    }),\n  ],\n})\nexport class TodoItemModule {}\n")),(0,o.kt)("p",null,"All aggregate queries use the following naming convention ",(0,o.kt)("inlineCode",{parentName:"p"},"${objectName}Aggregate"),"."),(0,o.kt)("p",null,"Below is a fragment from the generated schema for ",(0,o.kt)("inlineCode",{parentName:"p"},"TodoItem")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"nestjs-query")," will only expose number fields for ",(0,o.kt)("inlineCode",{parentName:"p"},"avg")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"sum"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql",metastring:"{10}","{10}":!0},"type Query {\n  todoItem(id: ID!): TodoItem\n  todoItems(\n    paging: CursorPaging = { first: 10 }\n\n    filter: TodoItemFilter = {}\n\n    sorting: [TodoItemSort!] = []\n  ): TodoItemConnection!\n  todoItemAggregate(filter: TodoItemAggregateFilter): [TodoItemAggregateResponse!]!\n}\n\ninput TodoItemAggregateFilter {\n  and: [TodoItemAggregateFilter!]\n  or: [TodoItemAggregateFilter!]\n  id: IDFilterComparison\n  title: StringFieldComparison\n  description: StringFieldComparison\n  completed: BooleanFieldComparison\n  created: DateFieldComparison\n  updated: DateFieldComparison\n  priority: NumberFieldComparison\n}\n\ntype TodoItemAggregateResponse {\n  groupBy: TodoItemAggregateGroupBy\n  count: TodoItemCountAggregate\n  sum: TodoItemSumAggregate\n  avg: TodoItemAvgAggregate\n  min: TodoItemMinAggregate\n  max: TodoItemMaxAggregate\n}\n\ntype TodoItemAvgAggregate {\n  id: Float\n  priority: Float\n}\n\ntype TodoItemAggregateGroupBy {\n  id: ID\n  title: String\n  description: String\n  completed: Boolean\n  created(by: GroupBy = DAY): DateTime\n  updated(by: GroupBy = DAY): DateTime\n  priority: Float\n  createdBy: String\n  updatedBy: String\n}\n\ntype TodoItemCountAggregate {\n  id: Int\n  title: Int\n  description: Int\n  completed: Int\n  created: Int\n  updated: Int\n  priority: Int\n}\n\ntype TodoItemMaxAggregate {\n  id: ID\n  title: String\n  description: String\n  created: DateTime\n  updated: DateTime\n  priority: Float\n}\n\ntype TodoItemMinAggregate {\n  id: ID\n  title: String\n  description: String\n  created: DateTime\n  updated: DateTime\n  priority: Float\n}\n\ntype TodoItemSumAggregate {\n  id: Float\n  priority: Float\n}\n\n")),(0,o.kt)("h2",{id:"examples"},"Examples"),(0,o.kt)("h3",{id:"basic"},"Basic"),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItemAggregate {\n    count {\n      id\n    }\n    sum {\n      id\n    }\n    avg {\n      id\n    }\n    min {\n      id\n      title\n      created\n    }\n    max {\n      id\n      title\n      created\n    }\n  }\n}\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItemAggregate": [\n      {\n        "count": {\n          "id": 5\n        },\n        "sum": {\n          "id": 15\n        },\n        "avg": {\n          "id": 3\n        },\n        "min": {\n          "id": "1",\n          "title": "Add Todo Item Resolver",\n          "created": "2021-03-29T06:51:26.061Z"\n        },\n        "max": {\n          "id": "5",\n          "title": "How to create item With Sub Tasks",\n          "created": "2021-03-29T06:51:26.061Z"\n        }\n      }\n    ]\n  }\n}\n')))),(0,o.kt)("h3",{id:"with-groupby"},"With GroupBy"),(0,o.kt)("p",null,"To group your aggregate queries you can add a ",(0,o.kt)("inlineCode",{parentName:"p"},"groupBy")," to specify one or more fields to group on."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql",metastring:"{3-5}","{3-5}":!0},"{\n  todoItemAggregate {\n    groupBy {\n      completed\n    }\n    count {\n      id\n    }\n    sum {\n      id\n    }\n    avg {\n      id\n    }\n    min {\n      id\n      title\n      created\n    }\n    max {\n      id\n      title\n      created\n    }\n  }\n}\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItemAggregate": [\n      {\n        "groupBy": {\n          "completed": false\n        },\n        "count": {\n          "id": 4\n        },\n        "sum": {\n          "id": 14\n        },\n        "avg": {\n          "id": 3.5\n        },\n        "min": {\n          "id": "2",\n          "title": "Add Todo Item Resolver",\n          "created": "2021-03-29T06:51:26.061Z"\n        },\n        "max": {\n          "id": "5",\n          "title": "How to create item With Sub Tasks",\n          "created": "2021-03-29T06:51:26.061Z"\n        }\n      },\n      {\n        "groupBy": {\n          "completed": true\n        },\n        "count": {\n          "id": 1\n        },\n        "sum": {\n          "id": 1\n        },\n        "avg": {\n          "id": 1\n        },\n        "min": {\n          "id": "1",\n          "title": "Create Nest App",\n          "created": "2021-03-29T06:51:26.061Z"\n        },\n        "max": {\n          "id": "1",\n          "title": "Create Nest App",\n          "created": "2021-03-29T06:51:26.061Z"\n        }\n      }\n    ]\n  }\n}\n')))),(0,o.kt)("h3",{id:"with-filter"},"With Filter"),(0,o.kt)("p",null,"You can also provide a filter to only aggregate on a subset of data."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItemAggregate(filter: { completed: { is: false } }) {\n    count {\n      id\n    }\n    min {\n      id\n      title\n      created\n    }\n    max {\n      id\n      title\n      created\n    }\n  }\n}\n\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItemAggregate": [\n      {\n        "count": {\n          "id": 4\n        },\n        "min": {\n          "id": "2",\n          "title": "Add Todo Item Resolver",\n          "created": "2021-03-29T06:51:26.061Z"\n        },\n        "max": {\n          "id": "5",\n          "title": "How to create item With Sub Tasks",\n          "created": "2021-03-29T06:51:26.061Z"\n        }\n      }\n    ]\n  }\n}\n')))),(0,o.kt)("p",null,"When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"count")," aggregate only non-null fields will be counted."),(0,o.kt)("p",null,"For example assume description is null for all todo items you will get ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," back."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItemAggregate(filter: { completed: { is: false } }) {\n    count {\n      id\n      title\n      description\n    }\n  }\n}\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n   "todoItemAggregate": [\n     {\n       "count": {\n         "id": 4,\n         "title": 4,\n         "description": 0\n       }\n     }\n   ]\n }\n}\n')))),(0,o.kt)("h2",{id:"aggregating-relations"},"Aggregating Relations"),(0,o.kt)("p",null,"When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"enableAggregate")," option any defined ",(0,o.kt)("inlineCode",{parentName:"p"},"many")," relations will also expose a aggregate query ",(0,o.kt)("inlineCode",{parentName:"p"},"{relationName}Aggregate")),(0,o.kt)("p",null,"Building on the previous example assume ",(0,o.kt)("inlineCode",{parentName:"p"},"TodoItem")," has a ",(0,o.kt)("inlineCode",{parentName:"p"},"subTasks")," connection."),(0,o.kt)("p",null,"The following schema fragment will be created"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql",metastring:"{17-19}","{17-19}":!0},"type TodoItem {\n  id: ID!\n  title: String!\n  description: String\n  completed: Boolean!\n  created: DateTime!\n  updated: DateTime!\n  age: Float!\n  priority: Float!\n  subTasks(\n    paging: CursorPaging = { first: 10 }\n\n    filter: SubTaskFilter = {}\n\n    sorting: [SubTaskSort!] = []\n  ): TodoItemSubTasksConnection!\n  subTasksAggregate(\n    filter: SubTaskAggregateFilter\n  ):[ TodoItemSubTasksAggregateResponse!]!\n}\n\ntype TodoItemSubTasksAggregateResponse {\n  groupBy: TodoItemSubTasksAggregateGroupBy\n  count: TodoItemSubTasksCountAggregate\n  sum: TodoItemSubTasksSumAggregate\n  avg: TodoItemSubTasksAvgAggregate\n  min: TodoItemSubTasksMinAggregate\n  max: TodoItemSubTasksMaxAggregate\n}\n\ntype TodoItemSubTasksAggregateGroupBy {\n  id: ID\n  title: String\n  description: String\n  completed: Boolean\n  created: DateTime\n  updated: DateTime\n  todoItemId: String\n  createdBy: String\n  updatedBy: String\n}\n\ntype TodoItemSubTasksAvgAggregate {\n  id: Float\n}\n\ntype TodoItemSubTasksCountAggregate {\n  id: Int\n  title: Int\n  description: Int\n  completed: Int\n  created: Int\n  updated: Int\n  todoItemId: Int\n}\n\ntype TodoItemSubTasksMaxAggregate {\n  id: ID\n  title: String\n  description: String\n  created: DateTime\n  updated: DateTime\n  todoItemId: String\n}\n\ntype TodoItemSubTasksMinAggregate {\n  id: ID\n  title: String\n  description: String\n  created: DateTime\n  updated: DateTime\n  todoItemId: String\n}\n\ntype TodoItemSubTasksSumAggregate {\n  id: Float\n}\n")),(0,o.kt)("h2",{id:"examples-1"},"Examples"),(0,o.kt)("h3",{id:"basic-1"},"Basic"),(0,o.kt)("p",null,"In this example we'll aggregate on all related ",(0,o.kt)("inlineCode",{parentName:"p"},"subTasks"),"."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItem(id: 5) {\n    subTasksAggregate {\n      count {\n        id\n      }\n      sum {\n        id\n      }\n      avg {\n        id\n      }\n      min {\n        id\n        title\n      }\n      max {\n        id\n        title\n      }\n    }\n  }\n}\n\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n   "todoItem": {\n     "subTasksAggregate": [\n       {\n         "count": {\n           "id": 3\n         },\n         "sum": {\n           "id": 42\n         },\n         "avg": {\n           "id": 14\n         },\n         "min": {\n           "id": "13",\n           "title": "How to create item With Sub Tasks - Sub Task 1"\n         },\n         "max": {\n           "id": "15",\n           "title": "How to create item With Sub Tasks - Sub Task 3"\n         }\n       }\n     ]\n   }\n }\n}\n')))),(0,o.kt)("h3",{id:"with-groupby-1"},"With GroupBy"),(0,o.kt)("p",null,"In this example we'll aggregate on all related ",(0,o.kt)("inlineCode",{parentName:"p"},"subTasks")," and group by ",(0,o.kt)("inlineCode",{parentName:"p"},"completed"),"."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItem(id: 5) {\n    subTasksAggregate {\n      groupBy {\n        completed\n      }\n      count {\n        id\n      }\n      sum {\n        id\n      }\n      avg {\n        id\n      }\n      min {\n        id\n        title\n      }\n      max {\n        id\n        title\n      }\n    }\n  }\n}\n\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n   "todoItem": {\n     "subTasksAggregate": [\n       {\n         "groupBy": {\n           "completed": false\n         },\n         "count": {\n           "id": 2\n         },\n         "sum": {\n           "id": 29\n         },\n         "avg": {\n           "id": 14.5\n         },\n         "min": {\n           "id": "14",\n           "title": "How to create item With Sub Tasks - Sub Task 2"\n         },\n         "max": {\n           "id": "15",\n           "title": "How to create item With Sub Tasks - Sub Task 3"\n         }\n       },\n       {\n         "groupBy": {\n           "completed": true\n         },\n         "count": {\n           "id": 1\n         },\n         "sum": {\n           "id": 13\n         },\n         "avg": {\n           "id": 13\n         },\n         "min": {\n           "id": "13",\n           "title": "How to create item With Sub Tasks - Sub Task 1"\n         },\n         "max": {\n           "id": "13",\n           "title": "How to create item With Sub Tasks - Sub Task 1"\n         }\n       }\n     ]\n   }\n }\n}\n')))),(0,o.kt)("h3",{id:"with-filter-1"},"With Filter"),(0,o.kt)("p",null,"This example will aggregate all related ",(0,o.kt)("inlineCode",{parentName:"p"},"subTasks")," that are not completed."),(0,o.kt)(l.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItem(id: 5) {\n    subTasksAggregate(filter: { completed: { is: false } }) {\n      count {\n        id\n      }\n      min {\n        id\n        title\n      }\n      max {\n        id\n        title\n      }\n    }\n  }\n}\n"))),(0,o.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n   "todoItem": {\n     "subTasksAggregate": [\n       {\n         "count": {\n           "id": 2\n         },\n         "min": {\n           "id": "14",\n           "title": "How to create item With Sub Tasks - Sub Task 2"\n         },\n         "max": {\n           "id": "15",\n           "title": "How to create item With Sub Tasks - Sub Task 3"\n         }\n       }\n     ]\n   }\n }\n}\n')))),(0,o.kt)("h2",{id:"advanced"},"Advanced"),(0,o.kt)("h3",{id:"enabling-aggregates-only-for-root"},"Enabling Aggregates Only For Root"),(0,o.kt)("p",null,"When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"enableAggregate")," option it will enable aggregates on the root type as well as all relations. If you only want to expose aggregate functionality on the root type you can specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"aggregate")," option."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{19}","{19}":!0},"import { NestjsQueryGraphQLModule } from '@ptc-org/nestjs-query-graphql'\nimport { NestjsQueryTypeOrmModule } from '@ptc-org/nestjs-query-typeorm'\nimport { Module } from '@nestjs/common'\nimport { TodoItemInputDTO } from './dto/todo-item-input.dto'\nimport { TodoItemUpdateDTO } from './dto/todo-item-update.dto'\nimport { TodoItemDTO } from './dto/todo-item.dto'\nimport { TodoItemEntity } from './todo-item.entity'\n\n@Module({\n  imports: [\n    NestjsQueryGraphQLModule.forFeature({\n      imports: [NestjsQueryTypeOrmModule.forFeature([TodoItemEntity])],\n      resolvers: [\n        {\n          DTOClass: TodoItemDTO,\n          EntityClass: TodoItemEntity,\n          CreateDTOClass: TodoItemInputDTO,\n          UpdateDTOClass: TodoItemUpdateDTO,\n          aggregate: { enabled: true }\n        }\n      ]\n    })\n  ]\n})\nexport class TodoItemModule {}\n")),(0,o.kt)("h3",{id:"disable-aggregate-for-single-relation"},"Disable Aggregate for Single Relation"),(0,o.kt)("p",null,"You can also selectively disable aggregates on an individual relation by specifying the enableAggregate option when defining the relation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{7}","{7}":!0},"import { FilterableField, FilterableConnection, IDField } from '@ptc-org/nestjs-query-graphql'\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql'\nimport { SubTaskDTO } from '../../sub-task/dto/sub-task.dto'\n\n@ObjectType('TodoItem')\n@FilterableConnection('subTasks', () => SubTaskDTO, { enableAggregate: false })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: number\n\n  @FilterableField()\n  title!: string\n\n  @FilterableField({ nullable: true })\n  description?: string\n\n  @FilterableField()\n  completed!: boolean\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date\n\n  @Field()\n  age!: number\n\n  @FilterableField()\n  priority!: number\n}\n\n")),(0,o.kt)("h3",{id:"group-aggregate-on-dayweekmonth"},"Group aggregate on DAY/WEEK/MONTH"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"This functionality only works for typeorm!")),(0,o.kt)("p",null,"You can change how datetime fields are grouped by passing ",(0,o.kt)("inlineCode",{parentName:"p"},"WEEK"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"MONTH")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"YEAR")," to the date fields ",(0,o.kt)("inlineCode",{parentName:"p"},"by"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItemAggregate {\n    groupBy {\n      created(by: MONTH)\n    }\n    count {\n      id\n    }\n    sum {\n      id\n    }\n  }\n}\n")))}T.isMDXComponent=!0}}]);