"use strict";(self.webpackChunknestjs_query=self.webpackChunknestjs_query||[]).push([[2e3],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,g=p["".concat(s,".").concat(m)]||p[m]||c[m]||l;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),r=n(4334);const l={tabItem:"tabItem_Ymn6"};function o(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(l.tabItem,o),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>T});var a=n(7462),r=n(7294),l=n(4334),o=n(2466),i=n(6550),s=n(1980),u=n(7392),d=n(12);function p(e){return function(e){var t,n;return null!=(t=null==(n=r.Children.map(e,(function(e){if(!e||(0,r.isValidElement)(e)&&(t=e.props)&&"object"==typeof t&&"value"in t)return e;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function c(e){var t=e.values,n=e.children;return(0,r.useMemo)((function(){var e=null!=t?t:p(n);return function(e){var t=(0,u.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function m(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function g(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId,l=(0,i.k6)(),o=function(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:n,groupId:a});return[(0,s._X)(o),(0,r.useCallback)((function(e){if(o){var t=new URLSearchParams(l.location.search);t.set(o,e),l.replace(Object.assign({},l.location,{search:t.toString()}))}}),[o,l])]}function h(e){var t,n,a,l,o=e.defaultValue,i=e.queryString,s=void 0!==i&&i,u=e.groupId,p=c(e),h=(0,r.useState)((function(){return function(e){var t,n=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(t=a.find((function(e){return e.default})))?t:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:o,tabValues:p})})),f=h[0],b=h[1],k=g({queryString:s,groupId:u}),y=k[0],N=k[1],T=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:u}.groupId),n=(0,d.Nk)(t),a=n[0],l=n[1],[a,(0,r.useCallback)((function(e){t&&l.set(e)}),[t,l])]),v=T[0],I=T[1],C=function(){var e=null!=y?y:v;return m({value:e,tabValues:p})?e:null}();return(0,r.useLayoutEffect)((function(){C&&b(C)}),[C]),{selectedValue:f,selectValue:(0,r.useCallback)((function(e){if(!m({value:e,tabValues:p}))throw new Error("Can't select invalid tab value="+e);b(e),N(e),I(e)}),[N,I,p]),tabValues:p}}var f=n(2389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){var t=e.className,n=e.block,i=e.selectedValue,s=e.selectValue,u=e.tabValues,d=[],p=(0,o.o5)().blockElementScrollPositionUntilNextRender,c=function(e){var t=e.currentTarget,n=d.indexOf(t),a=u[n].value;a!==i&&(p(t),s(a))},m=function(e){var t,n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":var a,r=d.indexOf(e.currentTarget)+1;n=null!=(a=d[r])?a:d[0];break;case"ArrowLeft":var l,o=d.indexOf(e.currentTarget)-1;n=null!=(l=d[o])?l:d[d.length-1]}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},t)},u.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:function(e){return d.push(e)},onKeyDown:m,onClick:c},o,{className:(0,l.Z)("tabs__item",b.tabItem,null==o?void 0:o.className,{"tabs__item--active":i===t})}),null!=n?n:t)})))}function y(e){var t=e.lazy,n=e.children,a=e.selectedValue,l=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){var o=l.find((function(e){return e.props.value===a}));return o?(0,r.cloneElement)(o,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a})})))}function N(e){var t=h(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",b.tabList)},r.createElement(k,(0,a.Z)({},e,t)),r.createElement(y,(0,a.Z)({},e,t)))}function T(e){var t=(0,f.Z)();return r.createElement(N,(0,a.Z)({key:String(t)},e))}},5693:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>f,frontMatter:()=>u,metadata:()=>p,toc:()=>m});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),o=n(4866),i=n(5162),s=["components"],u={title:"Paging"},d=void 0,p={unversionedId:"graphql/queries/paging",id:"graphql/queries/paging",title:"Paging",description:"nestjs-query supports multiple paging strategies that each have their own pros and cons. This documentation will",source:"@site/docs/graphql/queries/paging.mdx",sourceDirName:"graphql/queries",slug:"/graphql/queries/paging",permalink:"/nestjs-query/docs/graphql/queries/paging",draft:!1,editUrl:"https://github.com/tripss/nestjs-query/edit/master/documentation/docs/graphql/queries/paging.mdx",tags:[],version:"current",frontMatter:{title:"Paging"},sidebar:"docs",previous:{title:"Filtering",permalink:"/nestjs-query/docs/graphql/queries/filtering"},next:{title:"Sorting",permalink:"/nestjs-query/docs/graphql/queries/sorting"}},c={},m=[{value:"Cursor Based Paging",id:"cursor-based-paging",level:2},{value:"Offset Based Cursor",id:"offset-based-cursor",level:3},{value:"Key Set Based Cursor",id:"key-set-based-cursor",level:3},{value:"Sorting and Key set cursors",id:"sorting-and-key-set-cursors",level:4},{value:"Relation Connections",id:"relation-connections",level:3},{value:"Paging",id:"paging",level:3},{value:"Offset Based Paging",id:"offset-based-paging",level:2},{value:"Disabling Paging",id:"disabling-paging",level:2}],g={toc:m},h="wrapper";function f(e){var t=e.components,n=(0,r.Z)(e,s);return(0,l.kt)(h,(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"nestjs-query")," supports multiple paging strategies that each have their own pros and cons. This documentation will\ncover the different paging strategies and their applicable use cases."),(0,l.kt)("p",null,"The following examples are based on the following ",(0,l.kt)("inlineCode",{parentName:"p"},"TodoItemDTO")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts"',title:'"todo-item.dto.ts"'},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h2",{id:"cursor-based-paging"},"Cursor Based Paging"),(0,l.kt)("p",null,"By default ",(0,l.kt)("inlineCode",{parentName:"p"},"nestjs-query")," will expose all query many endpoints as cursor based ",(0,l.kt)("a",{parentName:"p",href:"https://relay.dev/graphql/connections.htm"},(0,l.kt)("inlineCode",{parentName:"a"},"connections"))," that you can use to page through results."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"When using cursor based connections you are not tied to any particular implementation described below, because of the opaque\nnature of cursors you can start out with the default and switch to key set based cursors later on without changing\nyour clients.")),(0,l.kt)("p",null,"All cursor connections, regardless of paging strategy, expose the following schema"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"scalar ConnectionCursor\n\ntype PageInfo {\n  hasNextPage: Boolean\n  hasPreviousPage: Boolean\n  startCursor: ConnectionCursor\n  endCursor: ConnectionCursor\n}\n\ntype TodoItemConnection {\n  pageInfo: PageInfo!\n  edges: [TodoItemEdge!]!\n}\n\ntype TodoItemEdge {\n  node: TodoItem!\n  cursor: ConnectionCursor!\n}\n\ntype TodoItem {\n  id: ID!\n  title: String!\n  description: String\n  completed: Boolean!\n  created: DateTime!\n  updated: DateTime!\n}\n")),(0,l.kt)("h3",{id:"offset-based-cursor"},"Offset Based Cursor"),(0,l.kt)("p",null,"By default all cursors will use a form of offset based paging to back cursors."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Pros"),(0,l.kt)("th",{parentName:"tr",align:null},"Cons"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Allow for recursive relation paging"),(0,l.kt)("td",{parentName:"tr",align:null},"Pages and nodes may change between queries")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Straight forward to implement"),(0,l.kt)("td",{parentName:"tr",align:null},"Inconsistent Sorting - natural sorting is used by default")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Queries grow more inefficient as you go through more pages")))),(0,l.kt)("h3",{id:"key-set-based-cursor"},"Key Set Based Cursor"),(0,l.kt)("p",null,"You have the option to specify a key set on your DTO which will replace the ",(0,l.kt)("inlineCode",{parentName:"p"},"offset")," with a ",(0,l.kt)("inlineCode",{parentName:"p"},"where")," clause. A keyset\nis a set of fields that uniquely identify a record (e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"id"),")."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Pros"),(0,l.kt)("th",{parentName:"tr",align:null},"Cons"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Consistent Results - All cursors uniquely identify a record allowing for deterministic before/after pages"),(0,l.kt)("td",{parentName:"tr",align:null},"Unable to do recursive paging for relations")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Stable Sorting - All results will be deterministically sorted"),(0,l.kt)("td",{parentName:"tr",align:null},"A unique key set must be specified")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Consistent performance with correct indexes in place"),(0,l.kt)("td",{parentName:"tr",align:null},"Unable to jump to arbitrary page")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Suitable for datasets of any size"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"To enable key set based paging all you need to do is decorate your ",(0,l.kt)("inlineCode",{parentName:"p"},"DTO")," with the ",(0,l.kt)("inlineCode",{parentName:"p"},"@KeySet")," decorator."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { FilterableField, IDField, KeySet } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@KeySet(['id'])\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h4",{id:"sorting-and-key-set-cursors"},"Sorting and Key set cursors"),(0,l.kt)("p",null,"When using key set based cursors we must take into account any client provided sorting in order to uniquely identify\na record within the sorted set of nodes"),(0,l.kt)("p",null,"For example assume we're using the same DTO as above. If we added a sort by ",(0,l.kt)("inlineCode",{parentName:"p"},"completed")," a comparision on ",(0,l.kt)("inlineCode",{parentName:"p"},"id")," would\nno longer be sufficient"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems(sorting: [{ field: completed, direction: ASC }]) {\n    edges {\n      cursor\n      node {\n        id\n        title\n        completed\n      }\n    }\n  }\n}\n")),(0,l.kt)("p",null,"If we only compared on the keyset ",(0,l.kt)("inlineCode",{parentName:"p"},"[id]")," our pages would no longer be sorted properly, if we only compared on\n",(0,l.kt)("inlineCode",{parentName:"p"},"completed")," you would not be able to page."),(0,l.kt)("p",null,"We solve this problem by encoding information about the each field in the sort as well as the key set fields into the\ncursor so we can page properly."),(0,l.kt)("p",null," In the above example the filter from the cursor (when paging forward) would be something like"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"WHERE (completed > ? OR (completed = ? AND id > ?))\n")),(0,l.kt)("h3",{id:"relation-connections"},"Relation Connections"),(0,l.kt)("p",null,"Key set paging will not apply to relations because they are recursive by nature."),(0,l.kt)("p",null,"For example if you query for multiple ",(0,l.kt)("inlineCode",{parentName:"p"},"TodoItems")," and their ",(0,l.kt)("inlineCode",{parentName:"p"},"subTasks")," if key set paging was used for the ",(0,l.kt)("inlineCode",{parentName:"p"},"subTasks"),"\nconnection  the cursor from one ",(0,l.kt)("inlineCode",{parentName:"p"},"todoItems")," ",(0,l.kt)("inlineCode",{parentName:"p"},"subTasks")," may not be applicable to all ",(0,l.kt)("inlineCode",{parentName:"p"},"todoItems")),(0,l.kt)("p",null,"For example, assume you have the following todo items and subTasks"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": 1,\n    "title": "Todo 1"\n    "subTasks": [\n      {"id": 1, "title": "Todo 1 - Sub Tasks 1"}, // cursor: "abc"\n      {"id": 2, "title": "Todo 1 - Sub Tasks 2"}  // cursor: "def"\n    ]\n  },\n  {\n    "id": 2,\n    "title": "Todo 2"\n    "subTasks": [\n      {"id": 3, "title": "Todo 2 - Sub Tasks 1"},  // cursor: "ghi"\n      {"id": 4, "title": "Todo 2 - Sub Tasks 2"}  // cursor: "jkl"\n    ]\n  }\n]\n')),(0,l.kt)("p",null,"If you ran the following graphql query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  todoItems {\n    edges {\n      node {\n        title\n        subTasks(paging: {first: 2, after: "ghi"}){\n          title\n        }\n      }\n    }\n  }\n}\n\n')),(0,l.kt)("p",null,"The resulting query would look for all subTasks with an id > 3 breaking paging for ",(0,l.kt)("inlineCode",{parentName:"p"},"Todo 1"),", for this reason the\n",(0,l.kt)("inlineCode",{parentName:"p"},"@KeySet")," decorator is used for all relations."),(0,l.kt)("h3",{id:"paging"},"Paging"),(0,l.kt)("p",null,"To page with cursors it works the same way for all strategies."),(0,l.kt)("p",null,"In this example we'll fetch the first 2 records."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems(paging: {first: 2}) {\n    pageInfo{\n      hasNextPage\n      hasPreviousPage\n      startCursor\n      endCursor\n    }\n    edges{\n      node{\n        id\n        title\n        completed\n        created\n        updated\n      }\n      cursor\n    }\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "pageInfo": {\n        "hasNextPage": true,\n        "hasPreviousPage": false,\n        "startCursor": "YXJyYXljb25uZWN0aW9uOjA=",\n        "endCursor": "YXJyYXljb25uZWN0aW9uOjE="\n      },\n      "edges": [\n        {\n          "node": {\n            "id": "1",\n            "title": "Create One Todo Item",\n            "completed": false,\n            "created": "2020-01-14T07:00:31.763Z",\n            "updated": "2020-01-14T07:00:31.763Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjA="\n        },\n        {\n          "node": {\n            "id": "2",\n            "title": "Create Many Todo Items - 1",\n            "completed": false,\n            "created": "2020-01-14T07:00:34.111Z",\n            "updated": "2020-01-14T07:00:34.111Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjE="\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("p",null,"Lets take a look the ",(0,l.kt)("inlineCode",{parentName:"p"},"pageInfo")," from the previous example"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "pageInfo": {\n    "hasNextPage": true,\n    "hasPreviousPage": false,\n    "startCursor": "YXJyYXljb25uZWN0aW9uOjA=",\n    "endCursor": "YXJyYXljb25uZWN0aW9uOjE="\n  },\n}\n')),(0,l.kt)("p",null,"Notice how ",(0,l.kt)("inlineCode",{parentName:"p"},"hasNextPage")," is ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," and there is an ",(0,l.kt)("inlineCode",{parentName:"p"},"endCursor")," that can be used to fetch the next page."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  todoItems(paging: { after: "YXJyYXljb25uZWN0aW9uOjE=", first: 2 }) {\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n      startCursor\n      endCursor\n    }\n    edges {\n      node {\n        id\n        title\n        completed\n        created\n        updated\n      }\n      cursor\n    }\n  }\n}\n'))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "pageInfo": {\n        "hasNextPage": true,\n        "hasPreviousPage": false,\n        "startCursor": "YXJyYXljb25uZWN0aW9uOjI=",\n        "endCursor": "YXJyYXljb25uZWN0aW9uOjM="\n      },\n      "edges": [\n        {\n          "node": {\n            "id": "3",\n            "title": "Create Many Todo Items - 2",\n            "completed": true,\n            "created": "2020-01-14T07:00:34.111Z",\n            "updated": "2020-01-14T07:00:34.111Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjI="\n        },\n        {\n          "node": {\n            "id": "4",\n            "title": "Create Many Todo Items - 3",\n            "completed": false,\n            "created": "2020-01-14T07:01:27.805Z",\n            "updated": "2020-01-14T07:01:27.805Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjM="\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("p",null,"We can also page backward by using ",(0,l.kt)("inlineCode",{parentName:"p"},"before")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"last"),". In the following example we'll use the ",(0,l.kt)("inlineCode",{parentName:"p"},"startCursor")," from the\nprevious example and set ",(0,l.kt)("inlineCode",{parentName:"p"},"last")," to 2."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  todoItems(paging: { before: "YXJyYXljb25uZWN0aW9uOjI=", last: 2 }) {\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n      startCursor\n      endCursor\n    }\n    edges {\n      node {\n        id\n        title\n        completed\n        created\n        updated\n      }\n      cursor\n    }\n  }\n}\n'))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "pageInfo": {\n        "hasNextPage": false,\n        "hasPreviousPage": false,\n        "startCursor": "YXJyYXljb25uZWN0aW9uOjA=",\n        "endCursor": "YXJyYXljb25uZWN0aW9uOjE="\n      },\n      "edges": [\n        {\n          "node": {\n            "id": "1",\n            "title": "Create One Todo Item",\n            "completed": false,\n            "created": "2020-01-14T07:00:31.763Z",\n            "updated": "2020-01-14T07:00:31.763Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjA="\n        },\n        {\n          "node": {\n            "id": "2",\n            "title": "Create Many Todo Items - 1",\n            "completed": false,\n            "created": "2020-01-14T07:00:34.111Z",\n            "updated": "2020-01-14T07:00:34.111Z"\n          },\n          "cursor": "YXJyYXljb25uZWN0aW9uOjE="\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"offset-based-paging"},"Offset Based Paging"),(0,l.kt)("p",null,"An alternative to cursor based querying is to use the ",(0,l.kt)("inlineCode",{parentName:"p"},"OFFSET")," ",(0,l.kt)("inlineCode",{parentName:"p"},"pagingStrategy"),". When using the ",(0,l.kt)("inlineCode",{parentName:"p"},"OFFSET")," strategy\nqueries that return multiple records will return an ",(0,l.kt)("inlineCode",{parentName:"p"},"OffsetConnection")," that looks like the following."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"type OffsetPageInfo {\n  hasNextPage: Boolean\n  hasPreviousPage: Boolean\n}\n\ntype TodoItemConnection {\n  pageInfo: OffsetPageInfo!\n  nodes: [TodoItem!]!\n}\n\ntype TodoItem {\n  id: ID!\n  title: String!\n  description: String\n  completed: Boolean!\n  created: DateTime!\n  updated: DateTime!\n}\n")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Pros"),(0,l.kt)("th",{parentName:"tr",align:null},"Cons"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Easy to understand"),(0,l.kt)("td",{parentName:"tr",align:null},"unstable - pages and nodes may change between queries")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Able to jump to arbitrary pages"),(0,l.kt)("td",{parentName:"tr",align:null},"Inconsistent Sorting - natural sorting is used in the strategy")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Queries grow more inefficient as you go through more pages")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"State must be maintained in the client to know last limit and offset in order to page")))),(0,l.kt)("p",null,"To enable OFFSET based paging all you need to do is set the ",(0,l.kt)("inlineCode",{parentName:"p"},"pagingStrategy")," option using the ",(0,l.kt)("inlineCode",{parentName:"p"},"@QueryOptions")," decorator."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ pagingStrategy: PagingStrategies.OFFSET })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("p",null,"In this example we'll fetch the first 2 records."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems(paging: { limit: 2 }) {\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n    }\n    nodes {\n      id\n      title\n      completed\n      created\n      updated\n    }\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "pageInfo": {\n        "hasNextPage": true,\n        "hasPreviousPage": false\n      },\n      "nodes": [\n        {\n          "id": "1",\n          "title": "Create Nest App",\n          "completed": true,\n          "created": "2021-02-14T12:56:01.106Z",\n          "updated": "2021-02-14T12:56:01.106Z"\n        },\n        {\n          "id": "2",\n          "title": "Create Entity",\n          "completed": false,\n          "created": "2021-02-14T12:56:01.106Z",\n          "updated": "2021-02-14T12:56:01.106Z"\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("p",null,"In this example we'll also pass in an offset to fetch the next 2 records."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems(paging: { limit: 2, offset: 2 }) {\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n    }\n    nodes {\n      id\n      title\n      completed\n      created\n      updated\n    }\n  }\n}\n\n\n"))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "pageInfo": {\n        "hasNextPage": true,\n        "hasPreviousPage": true\n      },\n      "nodes": [\n        {\n          "id": "3",\n          "title": "Create Entity Service",\n          "completed": false,\n          "created": "2021-02-14T12:56:01.106Z",\n          "updated": "2021-02-14T12:56:01.106Z"\n        },\n        {\n          "id": "4",\n          "title": "Add Todo Item Resolver",\n          "completed": false,\n          "created": "2021-02-14T12:56:01.106Z",\n          "updated": "2021-02-14T12:56:01.106Z"\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"disabling-paging"},"Disabling Paging"),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"This strategy is only recommended if you are sure your dataset is small.")),(0,l.kt)("p",null,"When using the ",(0,l.kt)("inlineCode",{parentName:"p"},"NONE")," paging strategy the ",(0,l.kt)("inlineCode",{parentName:"p"},"paging")," argument is removed and all methods will return an ",(0,l.kt)("inlineCode",{parentName:"p"},"ArrayConnection"),"."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Pros"),(0,l.kt)("th",{parentName:"tr",align:null},"Cons"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"All data is returned at once"),(0,l.kt)("td",{parentName:"tr",align:null},"Not suitable for large datasets")))),(0,l.kt)("p",null,"To disable paging all you can set the ",(0,l.kt)("inlineCode",{parentName:"p"},"pagingStrategy")," option using the ",(0,l.kt)("inlineCode",{parentName:"p"},"@QueryOptions")," decorator to\n",(0,l.kt)("inlineCode",{parentName:"p"},"PagingStrategies.NONE"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ pagingStrategy: PagingStrategies.NONE })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: number;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime)\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("p",null,"When using the strategy queries that return multiple records will return an array instead of a connection."),(0,l.kt)(o.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems {\n    id\n    title\n    completed\n    created\n    updated\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": [\n      {\n        "id": "1",\n        "title": "Create Nest App",\n        "completed": true,\n        "created": "2020-06-12T08:15:18.876Z",\n        "updated": "2020-06-12T08:15:18.876Z"\n      },\n      {\n        "id": "2",\n        "title": "Create Entity",\n        "completed": false,\n        "created": "2020-06-12T08:15:18.876Z",\n        "updated": "2020-06-12T08:15:18.876Z"\n      },\n      {\n        "id": "3",\n        "title": "Create Entity Service",\n        "completed": false,\n        "created": "2020-06-12T08:15:18.876Z",\n        "updated": "2020-06-12T08:15:18.876Z"\n      },\n      {\n        "id": "4",\n        "title": "Add Todo Item Resolver",\n        "completed": false,\n        "created": "2020-06-12T08:15:18.876Z",\n        "updated": "2020-06-12T08:15:18.876Z"\n      },\n      {\n        "id": "5",\n        "title": "How to create item With Sub Tasks",\n        "completed": false,\n        "created": "2020-06-12T08:15:18.876Z",\n        "updated": "2020-06-12T08:15:18.876Z"\n      }\n    ]\n  }\n}\n')))),(0,l.kt)("hr",null))}f.isMDXComponent=!0}}]);